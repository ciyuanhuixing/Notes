# 类型与变量

## 类型

类型（Type）：也称数据类型（Data Type）。不同数据类型的数据在内存中的形式是不同的。数据类型是性质相同的值的集合，每种数据类型配备了一系列专门针对这种类型的值的操作。

- 小内存容纳大尺寸数据会丢失精度、发生错误。
- 大内存容纳小尺寸数据会导致浪费。


C# 语言中用`dynamic`关键字模仿弱类型（动态类型）。

- 对于一个程序来说，它的静态指的是它的编辑期和编译期，它的动态指的是它的运行期。
- 静态（未运行）的程序是装在硬盘里的，动态（运行时）的程序是装在内存里的，运行一个程序指的是它从静态到动态的切换，实际上就是从硬盘里装载到内存里。

## 类型、变量与方法的关系

除了用明确的数据类型来声明变量，用`var`声明的变量可以由编译器推断出它的类型。

- 变量是存放数据的地方。
- 方法（旧称函数）是处理数据的逻辑，又称「算法」。

程序 = 数据 + 算法，因此有了变量和方法就可以写有意义的的程序了。

## 类型在 C# 语言中的作用

一个 C# 类型中所包含的信息有：

- 存储此类型变量所需的内存空间大小
- 此类型的值可表示的最大、最小值范围
- 此类型所包含的成员（如方法、属性、事件等）
- 此类型由何基类派生而来
- 程序运行时，此类型的变量分配在内存的什么位置
- 此类型所允许的操作（运算）

## C# 语言的类型系统

C# 的五大数据类型：

- 类（Classes）：如 Window、Form、Console、String
- 结构体（Structures）：如 Int32、Int64、Single、Double
- 枚举（Enumerations）：如 HorizontalAlignment、Visibility。枚举就是一个集合，枚举的值只能是这个集合中的某个值。
- 接口（Interface）
- 委托（Delegates）

![C# 类型的派生谱系](C:/My/1-BinaryFiles/9-MarkdownFileImages/2019-05-01-C-Sharp-%E8%AF%AD%E8%A8%80%E5%85%A5%E9%97%A8%E8%AF%A6%E8%A7%A3-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-1557556130913.jpg)

## 变量

### 变量的种类

变量一共有 7 种：

- 静态变量
- 实例变量（也称成员变量或字段）
- 数组元素
- 值参数
- 引用参数
- 输出形参
- 局部变量

狭义的变量指局部变量，因为其它种类的变量都有自己的约定名称。简单地讲，局部变量就是方法体里声明的变量。

变量的默认值：

- 字段有默认值。
- 局部变量没有赋值则编译不通过。

常量（值不可改变的变量）使用`const`关键字声明，声明时必须赋值，赋值后不可再次赋值。

### 变量、对象（实例）与内存的关系

Stack（栈）、Stack overflow（栈溢出）、Heap（堆）简介：

1. 程序在运行后把内存分为栈和堆这两个区域来对待。栈（比较小和快）用来存储函数调用，堆（比较大）用来存储对象。
2. 栈有两种情况会因存储太多而导致栈溢出：（1）程序算法没写好，函数调用太多；（2）程序有错误，在栈上分配了太多的内存。
3. 在堆里分配对象后如果忘记回收就会造成内存浪费，即内存泄露。在 C# 中有个叫垃圾收集器的机制，它会在某个时间点自动回收不用的内存，所以在 C# 中没有手动释放内存这一说，除了特殊情况，在 C# 中基本不容易出现内存泄露。可使用 Performance Monitor 查看进程的堆内存使用量。

表面上来看（从 C# 代码的上下文行文上来看），变量的用途是存储数据。实际上，变量表示了存储位置，并且每个变量都有一个类型，以决定什么样的值能够存入变量。变量 = 以变量名所对应的内存地址为起点、以其数据类型所要求的存储空间为长度的一块内存区域。

值类型的变量：

- 值类型没有实例，所谓的「实例」与变量合而为一。
- 值类型局部变量存储在栈上，它存储的就是变量的值。

引用类型的变量：

- 引用类型变量里存储的数据是对象的内存地址。
- 引用类型局部变量存储在栈上，它引用的对象（包括对象中的字段）存储在堆上。

装箱与拆箱（Boxing & Unboxing）：

- 装箱是指把值类型变量转为引用类型变量，在内存上是把栈上的值类型变量的值复制到堆上，再把堆上对应的内存地址作为引用类型变量的值。
- 拆箱是指把引用类型变量转为值类型变量，在内存上是把堆上引用类型变量引用的对象的值复制到栈上值类型变量所处的内存块中。

装箱和拆箱因为涉及内存中栈和堆上值的复制，所以会影响性能。

